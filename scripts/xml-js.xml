<?xml version="1.0"?>
<bindings xmlns="http://www.mozilla.org/xbl" xmlns:html="http://www.w3.org/1999/xhtml">

<binding id="mycode">
  <implementation>
    <constructor>
      
	  
	   <![CDATA[		
		
		// Get Top Header/Topic Area		

		//var topicHeader = document.getElementById("ch-container");
		var topicHeader = document.querySelector(".header-outer");
		//var topicHeader = document.getElementById("usr-container");

		// Replace Arrays

		var find = [
			/:crazy:/, 	
			/:roll:/,	
			/:illcontent:/	
		];
		var replaceWith = [
			"<img src=\"http://www.lighthead.net/mf/icons/smilies/crazy.gif\">", 	
			"<img src=\"http://www.lighthead.net/mf/icons/flashemotes/16x16/smi_roll.gif\">", 	
			"<img src=\"http://www.lighthead.net/mf/icons/flashemotes/16x16/smi_ill_content.gif\">"	
		];

		// Button below topic header

		// Smilies

		var smilies = document.createElement("input");	

		smilies.value = "Smilies (" + find.length + ")";
		smilies.className = "chatButton";	
		smilies.type = "button";
		smilies.id = "smileyToggle";

		topicHeader.appendChild(smilies);

		// Build Smiley Drown Down HTML
			
		var smileyHTML = "<dl>";
		for (var m=0; m<find.length; m++){
			var str = String(find[m]);		
			var findVal = str.replace(/\//g,""); // replace all instances of /
			smileyHTML += "<dt>" + findVal + "</dt><dd>" + replaceWith[m] + "</dd>";	
		}
		smileyHTML += "</dl>";

		// Hidden Div with Smiley Info

		var smiliesDiv = document.createElement("div");	
		smiliesDiv.id = "smileyBox";
		smiliesDiv.className = "boxHide";
		smiliesDiv.innerHTML = smileyHTML;
		topicHeader.appendChild(smiliesDiv);

		// Toggle the smiley box when the button is clicked

		smileyToggle.onclick = function()		
		{			
			smiliesDiv.className = ((smiliesDiv.className != 'boxShow') ? 'boxShow' : 'boxHide');			
		}


		// Replace Message Content

		window.addEventListener("animationstart",function(e){
			
			// Select all chat messages (not including username column)
			allMSGs = document.querySelectorAll(".msg-data span");
			
			// Loop through all messages
			for (var j=0; j<allMSGs.length; j++){	
			
				var str = allMSGs[j].innerHTML;				
				allMSGs[j].innerHTML = str.replaceArray(find, replaceWith);	
				
			}	
		},false);



		// Code from stackoverflow

		String.prototype.replaceArray = function(find, replace) {
		  var replaceString = this;
		  var regex; 
		  for (var i = 0; i < find.length; i++) {
			regex = new RegExp(find[i], "g");
			replaceString = replaceString.replace(regex, replace[i]);
		  }
		  return replaceString;
		};

		
		
		
		]]>
	  
    </constructor>
  </implementation>
</binding>

</bindings>